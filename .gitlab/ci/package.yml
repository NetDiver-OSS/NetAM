docker:package:
  stage: package
  image: docker:dind
  services:
    - name: docker:stable-dind
      command: [ "dockerd", "--host=unix:///var/run/docker.sock", "--host=tcp://0.0.0.0:2375", "--mtu=1450" ]
  variables:
    DOCKER_HOST: tcp://localhost:2375
  needs:
    - job: "ruby:test"
      artifacts: true
    - job: "rubocop:test"
      artifacts: true
  script:
    - docker build -t netam/netam:${CI_COMMIT_TAG} --network host .
    - docker login -u ${DOCKER_HUB_USER} -p ${DOCKER_HUB_TOKEN}
    - docker push netam/netam:${CI_COMMIT_TAG}
  only:
    - tags
